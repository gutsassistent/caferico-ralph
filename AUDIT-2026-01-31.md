# Caferico Full Audit â€” 31 januari 2026

## Samenvatting

4 parallelle analyses uitgevoerd: Code Quality & Architectuur, Security & Deployment, UX & Features, GitHub Status.

**Totaaloordeel:** Visueel en technisch sterk fundament (premium design, goede SEO, i18n compleet, accessibility). Maar meerdere features zijn mock/placeholder, er zijn security issues die vÃ³Ã³r launch gefixt moeten worden, en de backend-integraties zijn gecodeerd maar nog niet live geactiveerd.

---

## ğŸ”´ P0 â€” BLOKKEERDERS (fix vÃ³Ã³r launch)

### Security
1. **Webhook idempotency naar database** â€” in-memory `Set` gaat verloren bij restart â†’ duplicate orders. Moet Drizzle tabel worden met UNIQUE constraint op `molliePaymentId`
2. **WooCommerce credentials via HTTP Basic Auth** â€” nu in URL query params (lekt in logs). Verander naar `Authorization: Basic base64(key:secret)` in alle 4 bestanden
3. **Rate limiting op /api/checkout** â€” geen bescherming tegen bot-spam. `@upstash/ratelimit` of in-memory token bucket
4. **Webhook secret token** â€” voeg `?token=RANDOM_SECRET` toe aan Mollie webhook URL
5. **CSRF check op checkout POST** â€” verify Origin header

### Functionaliteit
6. **Contact form backend** â€” nu `console.log()`. Koppelen aan Resend (al in stack)
7. **Newsletter form backend** â€” nu `console.log()`. Koppelen aan email service
8. **Shop filters aansluiten** â€” type/format/form filters zijn pure UI, filteren niets
9. **Mollie redirect fix** â€” `NEXT_PUBLIC_BASE_URL` in Coolify env vars
10. **Google OAuth redirect URI** â€” toevoegen in Google Cloud Console

### Wettelijk (GDPR)
11. **Cookie consent banner** â€” verplicht in BelgiÃ«, ontbreekt volledig
12. **Privacy & Cookie beleid pagina** â€” live site heeft dit, nieuwe app niet
13. **Algemene Voorwaarden pagina** â€” verplicht voor e-commerce

---

## ğŸŸ¡ P1 â€” HOGE PRIORITEIT (binnen 2 weken na launch)

### Code Quality
14. **Consolideer WC API client** â€” 4 bestanden met duplicate fetch logic â†’ 1 shared `wcFetch` helper
15. **Fix duplicate `resolveCollection()`** â€” bestaat in types/product.ts EN ShopCatalog.tsx met **verschillende mappings** (coffee vs beans)
16. **Error boundaries** â€” geen `error.tsx` bestanden, unhandled errors tonen Next.js default
17. **Fix hardcoded `nl-NL`** in product page prijsformattering â†’ moet locale gebruiken
18. **Generieke error messages** â€” API routes lekken interne details

### Security
19. **Security headers** in next.config.mjs â€” CSP, X-Frame-Options, HSTS, Permissions-Policy
20. **Auth op checkout/status** â€” nu kan iedereen payment status opvragen met een ID
21. **`npm audit` in CI pipeline** toevoegen
22. **Pin next-auth versie** â€” beta software, `^5.0.0-beta.30` kan onverwacht breken

### Features
23. **Account adres bewerken** â€” nu read-only
24. **Smaak/Terroir pagina** â€” vermeld in CONTEXT.md als bestaande content, ontbreekt als route
25. **Echte product images** â€” sommige producten hebben gradient placeholders
26. **Drizzle push** als post-deployment command in Coolify

---

## ğŸ¨ UI POLISH (pre-launch)

40. **Meer contrast / vibrante kleuren** â€” UI is te donker op dit moment. Overall kleurpalet lichter en levendiger maken
41. **Product foto achtergronden** â€” foto's moeten achtergrondkleur hebben die matcht met de achtergrond van de pagina waarop ze staan (seamless look). Waar mogelijk voor alle producten, maar realistisch niet voor allemaal haalbaar

---

## ğŸŸ¢ P2 â€” BACKLOG (post-launch)

27. **Subscription checkout flow** â€” tier cards bestaan maar knoppen doen niets (Mollie Recurring)
28. **B2B pricing** â€” wholesale pricing in Next.js (vervangt WholesaleX)
29. **Blog CMS integratie** â€” nu hardcoded JSON, geen dynamische content
30. **Google Maps** op verkooppunten pagina â€” nu placeholder
31. **Database pool size** verhogen (nu max: 1)
32. **Redis/persistent cache** â€” in-memory cache verloren bij restart
33. **Integration tests** voor checkout + webhook flow
34. **`generateStaticParams`** voor product pages (SSG)
35. **Coupon/kortingscodes** in checkout
36. **Order tracking pagina**
37. **Email marketing service** kiezen (Resend/Loops/Brevo â€” vervangt MailPoet)
38. **Analytics** (GA4 of privacy-friendly alternatief)
39. **Facturatie n8n workflow** (geparkeerd â€” Jonathan bepaalt)

---

## ğŸ§¹ REPO OPRUIMING

### Stale branches (volledig gemerged, kunnen weg)
- `ralph/caferico-frontend` (local + remote)
- `ralph/auth` (local + remote)
- `ralph/mollie-checkout` (local + remote)
- `fix/auth-redirect` (local + remote)

### Ongemerged werk
- **`ralph/fix-api-metadata`** â€” 1 commit: `sanitize-html` voor XSS protection op product descriptions. Moet gemerged worden (nuttige security fix).

### Broken CI
- **"Deploy Flowchart to GitHub Pages"** workflow â€” 11/11 runs gefaild. Verwijderen of fixen.

---

## ğŸ“Š HUIDIGE STAAT PER FLOW

| Flow | Code | Werkend | Notities |
|------|------|---------|----------|
| Shop/Catalog | âœ… | âš ï¸ | Valt terug op mock data als WC API faalt. Filters niet aangesloten |
| Product Detail | âœ… | âš ï¸ | Hardcoded nl-NL prijzen. Sommige placeholder images |
| Cart | âœ… | âœ… | Robuust: localStorage, validatie, varianten |
| Checkout/Mollie | âœ… | âŒ | Redirect naar localhost (NEXT_PUBLIC_BASE_URL ontbreekt) |
| Auth (magic link) | âœ… | âš ï¸ | Code werkt, Resend geconfigureerd, maar Google OAuth 401 |
| Account | âœ… | âš ï¸ | Read-only. Duplicate WC fetch logic |
| Contact form | âœ… UI | âŒ | console.log(), geen email |
| Newsletter | âœ… UI | âŒ | console.log(), geen backend |
| Subscriptions | âœ… UI | âŒ | Knoppen doen niets |
| Blog | âœ… | âš ï¸ | Hardcoded JSON, geen CMS |
| i18n | âœ… | âœ… | 4 talen, 710 keys elk, 100% compleet |
| SEO | âœ… | âœ… | Structured data, sitemap, robots, meta |

---

## AANBEVOLEN VOLGORDE

**Fase 2E zou eigenlijk moeten heten: "Backend Activatie & Launch Prep"**

1. **Week 1:** P0 Security fixes (#1-5) + env vars fixen (#9-10)
2. **Week 2:** P0 Functionaliteit (#6-8) + wettelijke pagina's (#11-13)
3. **Week 3:** P1 Code quality (#14-18) + security headers (#19-22)
4. **Week 4:** P1 Features (#23-26) + repo opruiming + merge sanitize-html
5. **Post-launch:** P2 items op basis van gebruikersfeedback
