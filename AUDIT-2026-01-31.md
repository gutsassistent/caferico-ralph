# Caferico Planning â€” Gecalibreerd 1 feb 2026

## âœ… AFGEROND
- #2 WC credentials â†’ HTTP Basic Auth (`lib/wc-client.ts`)
- #14 WC API client geconsolideerd â†’ shared `wcFetch`
- #15 Duplicate `resolveCollection` â†’ single source of truth
- #16 Error boundaries â†’ 3 `error.tsx` bestanden
- #17 Hardcoded `nl-NL` â†’ dynamisch per locale
- #18 API error sanitization â†’ generieke messages naar client
- #19 Security headers â†’ 6 headers + `poweredByHeader: false`
- #21 `npm audit` in CI â†’ toegevoegd
- Repo opruiming â†’ 4 stale branches verwijderd (local + remote)

---

## ğŸ”´ P0 â€” VÃ³Ã³r launch

### Security (code â€” Guts kan autonoom)
1. **Webhook idempotency** â†’ Drizzle tabel met UNIQUE op molliePaymentId (in-memory Set verloren bij restart)
2. **Rate limiting** op /api/checkout â†’ `@upstash/ratelimit` of in-memory token bucket
3. **Webhook secret token** â†’ `?token=RANDOM_SECRET` in Mollie webhook URL
4. **CSRF check** op checkout POST â†’ verify Origin header
5. **Merge `ralph/fix-api-metadata`** â†’ sanitize-html XSS protection (1 commit, klaar)

### Functionaliteit (code â€” Guts kan autonoom)
6. **Contact form â†’ Resend** koppelen (nu `console.log()`)
7. **Newsletter form â†’ email service** koppelen (nu `console.log()`)
8. **Shop filters** daadwerkelijk aansluiten (nu pure UI, filteren niets)

### Env/config (Jonathan nodig)
9. **`NEXT_PUBLIC_BASE_URL`** in Coolify env vars (Mollie redirect fix)
10. **Google OAuth redirect URI** in Google Cloud Console
11. **Drizzle push** als post-deployment command in Coolify

### Wettelijk (content nodig)
12. **Cookie consent banner** bouwen (verplicht in BelgiÃ«)
13. **Privacy & Cookie beleid** pagina
14. **Algemene Voorwaarden** pagina

### UI Polish (design keuzes nodig)
15. **Meer contrast / vibrante kleuren** (te donker nu)
16. **Product foto achtergronden** matchen met pagina achtergrond

---

## ğŸŸ¡ P1 â€” Rond launch
17. **Auth op checkout/status** endpoint (nu openbaar)
18. **Pin next-auth** op exacte versie (beta software)
19. **Account adres bewerken** (nu read-only)
20. **Smaak/Terroir pagina** toevoegen (vermeld in CONTEXT.md, ontbreekt)
21. **Echte product images** (gradient placeholders vervangen)

---

## ğŸŸ¢ P2 â€” Post-launch backlog
22. **Subscription checkout** â€” Mollie Recurring voor 3 tiers (Proeverij, Klassiek, Atelier). Knoppen bestaan, doen niets.
23. **B2B pricing** â€” Wholesale in Next.js: bedrijfsaccounts, BTW-nummer, staffelprijzen, min. bestelwaarde. Vervangt WholesaleX.
24. **Blog CMS** â€” Nu hardcoded JSON (3 posts). WordPress REST API als bron (draait al) of headless CMS.
25. **Google Maps** â€” Verkooppunten pagina heeft placeholder kaart. Needs Maps API key.
26. **Database pool size** â€” Nu `max: 1`. Verhogen naar 5-10 voor concurrency.
27. **Redis/persistent cache** â€” In-memory cache (1h TTL) verloren bij restart. Redis voor productie.
28. **Integration tests** â€” Geen enkel testbestand. Jest/Vitest voor checkout + auth flow.
29. **generateStaticParams** â€” Product pages als statische HTML bij build (snellere laadtijd).
30. **Coupon/kortingscodes** â€” Geen coupon veld in checkout. WooCommerce coupons API koppelen.
31. **Order tracking** â€” Detail/tracking pagina met status + verzendinfo.
32. **Email marketing** â€” Service kiezen (Resend/Loops/Brevo). Vervangt MailPoet.
33. **Analytics** â€” GA4 of privacy-friendly (Plausible/Umami self-hosted op Hetzner).
34. **Facturatie n8n workflow** â€” Geparkeerd. Formulier â†’ PDF factuur + Mollie betaallink.

---

## ğŸ“Š Status per flow

| Flow | Status | Blokkeerder |
|------|--------|-------------|
| Shop/Catalog | âš ï¸ | Filters niet aangesloten (#8) |
| Product Detail | âœ… | â€” |
| Cart | âœ… | â€” |
| Checkout/Mollie | âŒ | NEXT_PUBLIC_BASE_URL (#9) |
| Auth (magic link) | âš ï¸ | Google OAuth (#10) |
| Account | âœ… | â€” |
| Contact form | âŒ | Backend ontbreekt (#6) |
| Newsletter | âŒ | Backend ontbreekt (#7) |
| Subscriptions | âŒ | Mollie Recurring (#22, P2) |
| Blog | âš ï¸ | Hardcoded JSON (#24, P2) |
| i18n | âœ… | â€” |
| SEO | âœ… | â€” |
| Error handling | âœ… | â€” |
| Security headers | âœ… | â€” |
